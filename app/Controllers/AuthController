<?php

namespace App\Controllers;

use App\Models\CustomerLoginModel;
use CodeIgniter\Controller;

class AuthController extends Controller
{
    public function login()
    {
        $loginModel = new CustomerLoginModel();

        if ($this->request->getMethod() === 'post') {
            $username = $this->request->getPost('username');
            $password = $this->request->getPost('password');

            // Basic validation
            if (empty($username) || empty($password)) {
                session()->setFlashdata('error', 'Username and password are required.');
                return view('auth/login');
            }

            if ($loginModel->login($username, $password)) {
                return redirect()->to('/dashboard'); // Redirect to dashboard on success
            } else {
                session()->setFlashdata('error', 'Invalid username or password.');
            }
        }

        return view('auth/login'); // Load the login view
    }

    public function logout()
    {
        $loginModel = new CustomerLoginModel();
        $loginModel->logout(); // Ensure this method destroys the session
        return redirect()->to('/login'); // Redirect to login page after logout
    }
}